@using System.Web.Optimization
@{
    if (Session["user"] == null || Session["user"].ToString() == "" ){
        Response.Redirect(Url.Action("Index","Login"));
    }
    ViewBag.GlobalTitle = AdminLTE1.App_Start.GlobalVariables.WebsiteName;
    }
<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>
        @if (!string.IsNullOrWhiteSpace(ViewBag.Title)) {
            @ViewBag.Title@: -
        }
        @ViewBag.GlobalTitle
    </title>
    <meta content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" name="viewport">
    <META HTTP-EQUIV="CACHE-CONTROL" CONTENT="NO-CACHE">
    <link href="~/Content/css/font-awesome.min.css" rel="stylesheet">
    <link href="~/Content/css/icheck/blue.min.css" rel="stylesheet">
    @Styles.Render("~/Bundles/css")
    @Scripts.Render("~/Bundles/js")
    <!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
    <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
    <style>
        .select2-dropdown {
            z-index: 999999;
        }
        #mytableactiveproj tr.group,
        #mytableactiveproj tr.group:hover {
            background-color: #ddd !important;
        }
    </style>
</head>
<body class="hold-transition skin-blue sidebar-mini">
    <div class="modal inmodal fade" id="myModal_change" tabindex="-1" role="dialog" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Cancel</span></button>
                    <h4 class="modal-title">Change Password</h4>
                    <small class="font-bold"></small>
                </div>

                <form method="post">
                    <div class="modal-body">
                        <div class="form-group">
                            <label>Old Password : </label>
                            <input name="oldPassword" type="password" class="form-control" id="oldPassword" required />
                        </div>
                        <div class="form-group">
                            <label>New Password : </label>
                            <input name="newPassword" type="password" class="form-control" id="newPassword" required />
                        </div>
                        <div class="form-group">
                            <label>Confirm New Password : </label>
                            <input name="confirmNewPassword" type="password" class="form-control" id="confirmNewPassword" required />
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" id="changePassCancel" class="btn btn-white" data-dismiss="modal">Cancel</button>
                        <button type="submit" id="changepassbtn" class="btn btn-primary">Save changes</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <div class="wrapper no-padding" >
        @Html.Partial("_Header")
        @Html.Partial("_Sidebar")

        <div class="content-wrapper">
            @Html.Partial("_Timeline")
            <section class="content-header">
                <h1>
                    @ViewBag.Title
                    <small>@ViewBag.Description</small>
                </h1>
            </section>

            <section class="content">
                @RenderBody() 
            </section>
        </div>

        @*@Html.Partial("_ControlSidebar")*@
    </div>

    @*  INI KODINGAN CHATBOX  *@
    @if (Session["project"] != null && ViewContext.RouteData.Values["Controller"].ToString() != "Project" && ViewContext.RouteData.Values["Controller"].ToString() != "Role" && ViewContext.RouteData.Values["Controller"].ToString() != "Home" && ViewContext.RouteData.Values["Controller"].ToString() != "Master")
    {
    <div class="small-chat-box fadeInRight animated" style="z-index:1000000000">
        <div class="heading" draggable="true">
            Notes
        </div>
        <div class="content">
            <div class="left">
                <div class="author-name">
                    Monica Jackson <small class="chat-date">
                        27 Juni 2017
                    </small>
                </div>
                <div class="chat-message">
                    Lorem Ipsum is simply dummy text input.
                </div>
            </div>
            <div class="left">
                <div class="author-name">
                    Mick Smith
                    <small class="chat-date">
                        27 Juni 2017
                    </small>
                </div>
                <div class="chat-message">
                    Lorem Ipsum is simpl.
                </div>
            </div>
            <div class="left">
                <div class="author-name">
                    Alice Novak
                    <small class="chat-date">
                        27 Juni 2017
                    </small>
                </div>
                <div class="chat-message">
                    Check this stock char.
                </div>
            </div>
            <div class="left">
                <div class="author-name">
                    Anna Lamson
                    <small class="chat-date">
                        27 Juni 2017
                    </small>
                </div>
                <div class="chat-message">
                    The standard chunk of Lorem Ipsum
                </div>
            </div>
            <div class="left">
                <div class="author-name">
                    Mick Lane
                    <small class="chat-date">
                        27 Juni 2017
                    </small>
                </div>
                <div class="chat-message">
                    I belive that. Lorem Ipsum is simply dummy text.
                </div>
            </div>

        </div>
        <div class="form-chat">
            <div class="input-group input-group-sm">
                <input type="text" class="form-control"> <span class="input-group-btn">
                    <button class="btn btn-primary" type="button">
                        Add
                    </button>
                </span>
            </div>
        </div>
    </div>

    <div id="small-chat" >
        <span class="badge badge-warning pull-right">5</span>
        <a class="open-small-chat">
            <i class="fa fa-comments"></i>
        </a>
    </div>
    }
    else
    {
        //Session["project"] = null;
    }
    @* INI AKHIR KODINGAN CHATBOX *@
    <script src="@RouteJs.RouteJsHandler.HandlerUrl"></script>
    <script>
        $(document).ready(function () {
            
            //$("#myTable").DataTable();
            $("#changepass_").click(function () {
                $("#oldPassword").val("");
                $("#newPassword").val("");
                $("#confirmNewPassword").val("");
            });
            $("#changepassbtn").click(function () {
                var oldpass = $("#oldPassword").val();
                var newpass = $("#newPassword").val();
                var confnewpass = $("#confirmNewPassword").val();
                if (oldpass == "" || newpass == "" || confnewpass == "") {
                    
                }
                else if (newpass != confnewpass  ) {
                    swal("Failed!", "Password confirmation doesn't match Password", "error");
                }
                else {
                    $.ajax({
                            type: "POST",
                            url: "@Url.Action("change_password","Home")",
                            data: { oldPassword: oldpass, newPassword : newpass},
                        success: function (data) {
                            if (data == "1") {
                                swal("Success!", "Password Changed", "success");
                                $("#changePassCancel").click();
                            }
                            else {
                                swal("Failed!", "Please enter password correctly!", "error");
                            }
                        },
                        error: function (xhr, status, error) {
                            alert(xhr.responseText);
                        }
                    });
                }

                return false;
            });
        });
    </script>
</body>
</html>